<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pantry-Pal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/64/12493/12493626.png" type="image/png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        @keyframes pulse-bg {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        .animate-pulse-bg {
            background: linear-gradient(to right, #f0f0f0 0%, #e0e0e0 20%, #f0f0f0 40%, #f0f0f0 100%);
            background-size: 200% 100%;
            animation: pulse-bg 1.5s infinite cubic-bezier(0.4, 0, 0.6, 1);
        }

        /* Specific pulse background for the send button when loading */
        .send-button-pulse {
            background: linear-gradient(to right, #d1d5db 0%, #a1a1aa 20%, #d1d5db 40%, #d1d5db 100%); /* Gray shades for the pulse */
            background-size: 200% 100%;
            animation: pulse-bg 1.5s infinite cubic-bezier(0.4, 0, 0.6, 1);
        }

        /* Keyframes for bounce/wiggle animation */
        @keyframes bounce-wiggle {
            0%, 100% { transform: translateX(0) translateY(0); }
            25% { transform: translateX(-2px) translateY(-2px); }
            50% { transform: translateX(2px) translateY(2px); }
            75% { transform: translateX(-2px) translateY(-2px); }
        }

        .animate-bounce-wiggle {
            animation: bounce-wiggle 0.3s ease-in-out;
        }

        /* Category selection pulse/glow */
        @keyframes category-pulse {
            0% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.7); } /* Indigo-500 equivalent */
            70% { box-shadow: 0 0 0 8px rgba(99, 102, 241, 0); }
            100% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0); }
        }

        .category-selected-glow {
            animation: category-pulse 1s ease-out;
        }

        /* Checkmark for selected category */
        .category-selected-checkmark::after {
            content: '✓'; /* Unicode checkmark */
            position: absolute;
            top: 4px;
            right: 4px;
            font-size: 0.8em;
            color: white;
            background-color: #4CAF50; /* Green */
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            line-height: 1; /* Adjust line-height to center the checkmark vertically */
        }
    </style>
</head>
<body class="font-['Outfit'] bg-gradient-to-br from-purple-100 via-rose-100 to-amber-100 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-sm mx-auto bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 space-y-2">
        
        <div class="text-center">
            <div class="flex items-center justify-center mx-auto mb-2">
                <img src="https://cdn-icons-png.flaticon.com/512/2515/2515263.png" alt="Pantry-Pal Logo" class="w-16 h-16 mr-2">
                <h1 class="text-2xl font-bold text-gray-800">Pantry-Pal</h1>
            </div>
            <p class="text-gray-500 mt-1">What did we have today? ✨</p>
        </div>

        <div class="flex border-b-2 border-gray-300 -mx-6 px-6 pt-2">
            <button id="tab-category" class="flex-1 py-2 px-3 text-center text-base font-bold rounded-t-xl cursor-pointer transition-colors duration-200 bg-indigo-500 text-white shadow-md">Add</button>
            <button id="tab-today" class="flex-1 py-2 px-3 text-center text-base font-bold rounded-t-xl cursor-pointer transition-colors duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300">Today</button>
        </div>

        <div class="pt-4 mt-4 border-t border-gray-200">
            <div id="kcal-progress-bar-container" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="1500" class="w-full bg-gray-200 rounded-full h-3 relative overflow-hidden">
                <div id="kcal-progress-fill" class="h-full bg-green-500 transition-all duration-500 ease-in-out" style="width: 0%;"></div>
            </div>
            <p id="kcal-progress-text" class="text-sm font-semibold text-gray-700 text-center mt-2">0 Kcal / 1500 Kcal</p>
        </div>
        <div id="section-category" class="space-y-2 mt-4">
            <div>
                <div id="category-container" class="grid grid-cols-3 gap-3 mt-2">
                    <button class="relative border-2 rounded-xl p-2 flex flex-col items-center justify-center cursor-pointer transition-all duration-200 ease-in-out border-sky-200 bg-sky-100 text-sky-800 hover:border-sky-400" data-category="Breakfast">
                        <img src="https://cdn-icons-png.flaticon.com/512/9702/9702245.png" class="w-10 h-10 transition-transform duration-600 ease-in">
                        <span class="mt-1.5 text-xs font-medium">Breakfast</span>
                    </button>
                    <button class="relative border-2 rounded-xl p-2 flex flex-col items-center justify-center cursor-pointer transition-all duration-200 ease-in-out border-violet-200 bg-violet-100 text-violet-800 hover:border-violet-400" data-category="Collagen">
                        <img src="https://cdn-icons-png.flaticon.com/512/11210/11210895.png" class="w-10 h-10 transition-transform duration-600 ease-in">
                        <span class="mt-1.5 text-xs font-medium">Collagen</span>
                    </button>
                    <button class="relative border-2 rounded-xl p-2 flex flex-col items-center justify-center cursor-pointer transition-all duration-200 ease-in-out border-amber-200 bg-amber-100 text-amber-800 hover:border-amber-400" data-category="Coffee">
                        <img src="https://cdn-icons-png.flaticon.com/512/1448/1448438.png" class="w-10 h-10 transition-transform duration-600 ease-in">
                        <span class="mt-1.5 text-xs font-medium">Coffee</span>
                    </button>
                    <button class="relative border-2 rounded-xl p-2 flex flex-col items-center justify-center cursor-pointer transition-all duration-200 ease-in-out border-lime-200 bg-lime-100 text-lime-800 hover:border-lime-400" data-category="Lunch">
                        <img src="https://cdn-icons-png.flaticon.com/512/2515/2515271.png" class="w-10 h-10 transition-transform duration-600 ease-in">
                        <span class="mt-1.5 text-xs font-medium">Lunch</span>
                    </button>
                    <button class="relative border-2 rounded-xl p-2 flex flex-col items-center justify-center cursor-pointer transition-all duration-200 ease-in-out border-teal-200 bg-teal-100 text-teal-800 hover:border-teal-400" data-category="Exercise">
                        <img src="https://cdn-icons-png.flaticon.com/512/7681/7681038.png" class="w-10 h-10 transition-transform duration-600 ease-in">
                        <span class="mt-1.5 text-xs font-medium">Exercise</span>
                    </button>
                    <button class="relative border-2 rounded-xl p-2 flex flex-col items-center justify-center cursor-pointer transition-all duration-200 ease-in-out border-slate-200 bg-slate-100 text-slate-800 hover:border-slate-400" data-category="Other">
                        <img src="https://cdn-icons-png.flaticon.com/512/7245/7245102.png" class="w-10 h-10 transition-transform duration-600 ease-in">
                        <span class="mt-1.5 text-xs font-medium">Other</span>
                    </button>
                </div>
                <input type="hidden" id="selected-category" name="category">
            </div>

            <div class="space-y-2">
                <div>
                    <label for="description" class="sr-only">Description</label>
                    <input type="text" id="description" name="description" placeholder="Description (e.g., Avocado toast)" class="mt-1.5 p-3 block w-full border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-300 focus:border-indigo-400 bg-white/70 shadow-sm">
                </div>
                <div>
                    <label for="kcal" class="sr-only">Kcal</label>
                    <input type="number" id="kcal" name="kcal" placeholder="Kcal (e.g., 350)" class="mt-1.5 p-3 block w-full border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-300 focus:border-indigo-400 bg-white/70 shadow-sm">
                </div>
            </div>
            
            <button id="send-btn" class="w-full flex items-center justify-center p-3 bg-rose-500 text-white text-lg font-bold rounded-xl shadow-md transition-all duration-200 ease-in-out transform scale-100 hover:bg-rose-600 active:bg-rose-700 active:scale-100">
                <span id="send-btn-content" class="flex items-center justify-center">
                    Log My Meal!
                    <svg class="w-6 h-6 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                </span>
                <span id="send-btn-loading-text" class="hidden">Processing...</span>
            </button>
            
            <div id="message-area" class="text-center font-medium"></div>

        </div>

        <div id="section-today" class="space-y-2 mt-4 hidden">
            <div id="notion-items-display" class="bg-gray-50 p-4 rounded-lg shadow-inner max-h-80 overflow-y-auto space-y-2 text-lg text-gray-700 mt-2">
                </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const categoryContainer = document.getElementById('category-container');
            const hiddenCategoryInput = document.getElementById('selected-category');
            const descriptionInput = document.getElementById('description');
            const kcalInput = document.getElementById('kcal'); 
            const sendBtn = document.getElementById('send-btn');
            const messageArea = document.getElementById('message-area');

            // Elements for button loading state
            const sendBtnContent = document.getElementById('send-btn-content');
            const sendBtnLoadingText = document.getElementById('send-btn-loading-text');

            const notionItemsDisplay = document.getElementById('notion-items-display');

            // Kcal Progress Bar Elements
            const kcalProgressBarContainer = document.getElementById('kcal-progress-bar-container');
            const kcalProgressFill = document.getElementById('kcal-progress-fill');
            const kcalProgressText = document.getElementById('kcal-progress-text');
            const KCAL_CAP = 1500; // Define the Kcal cap

            // Tab Elements
            const tabCategoryBtn = document.getElementById('tab-category');
            const tabTodayBtn = document.getElementById('tab-today');
            const sectionCategory = document.getElementById('section-category');
            const sectionToday = document.getElementById('section-today');

            // --- NOTION API ENDPOINT CONFIGURATION ---
            // const NOTION_BACKEND_URL = 'https://pantrypal-gilt.vercel.app/api/pantryapi';
            const NOTION_BACKEND_URL = '/api/pantryapi'; // Local deployment

            // Define placeholder values for each category
            const kcalPlaceholders = {
                "Coffee": "50",
                "Breakfast": "311",
                "Lunch": "800",
                "Collagen": "40",
                "Exercise": "300" // Added for consistency
            };

            // --- Tab Switching Logic ---
            const tabBaseClasses = ['flex-1', 'py-2', 'px-3', 'text-center', 'text-base', 'font-bold', 'rounded-t-xl', 'cursor-pointer', 'transition-colors', 'duration-200'];
            const tabDefaultClasses = ['bg-gray-200', 'text-gray-700', 'hover:bg-gray-300'];
            const tabActiveClass = ['bg-indigo-500', 'text-white', 'shadow-md'];

            function setTabActiveState(button, isActive) {
                button.classList.remove(...tabDefaultClasses, ...tabActiveClass);
                if (isActive) {
                    button.classList.add(...tabActiveClass);
                } else {
                    button.classList.add(...tabDefaultClasses);
                }
            }

            function showTab(tabName) {
                setTabActiveState(tabCategoryBtn, false);
                setTabActiveState(tabTodayBtn, false);

                sectionCategory.classList.add('hidden');
                sectionToday.classList.add('hidden');

                if (tabName === 'category') {
                    setTabActiveState(tabCategoryBtn, true);
                    sectionCategory.classList.remove('hidden');
                } else if (tabName === 'today') {
                    setTabActiveState(tabTodayBtn, true);
                    sectionToday.classList.remove('hidden');
                    loadNotionItems(); // Always load/reload items when switching tabs
                }
            }

            // --- Logic for Category Selection ---
            const categorySelectedClasses = ['border-indigo-500', 'bg-indigo-300', 'text-indigo-900', 'scale-105', 'shadow-lg', 'category-selected-glow', 'category-selected-checkmark'];
            const categoryDefaultImgClasses = ['transition-transform', 'duration-600', 'ease-in'];

            categoryContainer.addEventListener('click', function(e) {
                const clickedButton = e.target.closest('button');
                if (!clickedButton || !clickedButton.dataset.category) return;

                const allButtons = categoryContainer.querySelectorAll('button');
                allButtons.forEach(btn => {
                    btn.classList.remove(...categorySelectedClasses);
                    // Remove checkmark via class removal
                    btn.classList.remove('category-selected-checkmark');
                    const img = btn.querySelector('img');
                    if (img) {
                        img.classList.remove('scale-125', 'ease-out');
                        img.classList.add('ease-in');
                    }
                });

                clickedButton.classList.add(...categorySelectedClasses);
                const clickedImg = clickedButton.querySelector('img');
                if (clickedImg) {
                    clickedImg.classList.add('scale-125', 'ease-out');
                    clickedImg.classList.remove('ease-in');
                }
                
                const selectedCategory = clickedButton.dataset.category; // Get selected category directly
                hiddenCategoryInput.value = selectedCategory; // Set hidden input value

                // Update placeholder and potentially Kcal input for 'Exercise'
                if (kcalPlaceholders[selectedCategory]) {
                    kcalInput.placeholder = `Kcal (e.g., ${kcalPlaceholders[selectedCategory]})`;
                    // Automatically set Kcal if a placeholder exists and it's positive for Exercise
                    if (selectedCategory === "Exercise" && kcalInput.value === "") {
                        kcalInput.value = -Math.abs(parseInt(kcalPlaceholders[selectedCategory] || 0));
                    }
                } else {
                    kcalInput.placeholder = "Kcal (e.g., 350)"; // Default placeholder
                }

                // If 'Exercise' is selected, ensure Kcal is negative
                if (selectedCategory === "Exercise") {
                    if (kcalInput.value !== "") {
                        kcalInput.value = -Math.abs(parseInt(kcalInput.value || 0));
                    }
                    kcalInput.focus(); // Focus on Kcal input to encourage entry
                } else if (parseInt(kcalInput.value) < 0) {
                    // If not Exercise and Kcal is negative, make it positive
                    kcalInput.value = Math.abs(parseInt(kcalInput.value));
                }
            });

            // Listen for changes in the Kcal input to ensure 'Exercise' values stay negative
            kcalInput.addEventListener('input', function() {
                const selectedCategory = hiddenCategoryInput.value;
                if (selectedCategory === "Exercise" && parseInt(this.value) > 0) {
                    this.value = -Math.abs(parseInt(this.value));
                } else if (selectedCategory !== "Exercise" && parseInt(this.value) < 0) {
                    this.value = Math.abs(parseInt(this.value));
                }
            });

            // --- Function to send data to Notion via backend (POST request) ---
            async function sendToNotion(data) {
                messageArea.textContent = ''; // Clear message area
                sendBtn.disabled = true; // Disable button
                sendBtnContent.classList.add('hidden'); // Hide original content
                sendBtnLoadingText.classList.remove('hidden'); // Show loading text

                // Apply gray background, pulse animation, and disable cursor
                sendBtn.classList.remove('bg-rose-500', 'text-white', 'hover:bg-rose-600', 'active:bg-rose-700', 'shadow-md');
                sendBtn.classList.add('bg-gray-400', 'text-gray-600', 'send-button-pulse', 'cursor-not-allowed');

                try {
                    const response = await fetch(NOTION_BACKEND_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        console.error('Backend (POST) error:', errorData);
                        throw new Error(`Error: ${errorData.message || errorData.error || 'Unknown backend error'}`);
                    }

                    const result = await response.json();
                    console.log('Successfully sent to Notion via backend:', result);
                    loadNotionItems(); // Refresh data after sending
                } catch (error) {
                    console.error('Failed to send to Notion:', error);
                    messageArea.textContent = `Error: ${error.message || 'Network error'}`;
                    messageArea.style.color = '#dc2626'; // Red for error
                } finally {
                    // Restore button state after a short delay for user feedback
                    setTimeout(() => {
                        messageArea.textContent = ''; // Clear message after delay
                        hiddenCategoryInput.value = '';
                        descriptionInput.value = '';
                        kcalInput.value = ''; 
                        kcalInput.placeholder = "Kcal (e.g., 350)"; // Reset to default placeholder
                        const allButtons = categoryContainer.querySelectorAll('button');
                        allButtons.forEach(btn => {
                            btn.classList.remove(...categorySelectedClasses);
                            const img = btn.querySelector('img');
                            if (img) {
                                img.classList.remove('scale-125', 'ease-out');
                                img.classList.add('ease-in'); 
                            }
                        });

                        // Restore original button styles and re-enable
                        sendBtn.disabled = false;
                        sendBtnContent.classList.remove('hidden');
                        sendBtnLoadingText.classList.add('hidden');
                        sendBtn.classList.remove('bg-gray-400', 'text-gray-600', 'send-button-pulse', 'cursor-not-allowed');
                        sendBtn.classList.add('bg-rose-500', 'text-white', 'hover:bg-rose-600', 'active:bg-rose-700', 'shadow-md');
                    }, 2000);
                }
            }

            // Function to generate skeleton loader HTML
            function getSkeletonLoaderHtml(count = 3) {
                let html = '';
                for (let i = 0; i < count; i++) {
                    html += `
                        <div class="h-6 bg-gray-200 rounded w-full mb-2 animate-pulse-bg"></div>
                    `;
                }
                return html;
            }

            // --- Function to update the Kcal progress bar ---
            let lastPercentage = 0; // To track previous percentage for threshold animation
            function updateKcalProgressBar(currentKcalSum) {
                const newPercentage = Math.min(100, (currentKcalSum / KCAL_CAP) * 100);
                
                kcalProgressFill.style.width = `${newPercentage}%`;
                
                let emoji = '';
                if (currentKcalSum <= KCAL_CAP) {
                    emoji = '✨ '; // Encouraging emoji when below or at target
                } else if (currentKcalSum > KCAL_CAP) {
                    emoji = '⚠️ '; // Warning emoji when over target
                }
                kcalProgressText.textContent = `${emoji}${currentKcalSum} Kcal / ${KCAL_CAP} Kcal`;

                // Update colors based on progress
                if (currentKcalSum > KCAL_CAP) {
                    kcalProgressFill.classList.remove('bg-green-500', 'bg-yellow-500');
                    kcalProgressFill.classList.add('bg-red-500', 'bg-gradient-to-r', 'from-red-400', 'to-red-600'); // Gradient for red
                    kcalProgressText.classList.remove('text-gray-700', 'text-amber-600');
                    kcalProgressText.classList.add('text-red-600');
                } else if (newPercentage >= 80) { // Nearing cap, turn yellow
                    kcalProgressFill.classList.remove('bg-green-500', 'bg-red-500');
                    kcalProgressFill.classList.add('bg-yellow-500', 'bg-gradient-to-r', 'from-amber-400', 'to-amber-600'); // Gradient for yellow
                    kcalProgressText.classList.remove('text-gray-700', 'text-red-600');
                    kcalProgressText.classList.add('text-amber-600');
                } else {
                    kcalProgressFill.classList.remove('bg-red-500', 'bg-yellow-500', 'from-red-400', 'to-red-600', 'from-amber-400', 'to-amber-600');
                    kcalProgressFill.classList.add('bg-green-500', 'bg-gradient-to-r', 'from-green-400', 'to-green-600'); // Gradient for green
                    kcalProgressText.classList.remove('text-red-600', 'text-amber-600');
                    kcalProgressText.classList.add('text-gray-700');
                }

                // Apply bounce/wiggle animation if a threshold is crossed
                if ((lastPercentage < 50 && newPercentage >= 50) ||
                    (lastPercentage < 80 && newPercentage >= 80) ||
                    (lastPercentage < 100 && newPercentage >= 100) ||
                    (lastPercentage <= 100 && newPercentage > 100)) { // New: bounce if going over cap
                    kcalProgressBarContainer.classList.add('animate-bounce-wiggle');
                    kcalProgressText.classList.add('animate-bounce-wiggle');
                    setTimeout(() => {
                        kcalProgressBarContainer.classList.remove('animate-bounce-wiggle');
                        kcalProgressText.classList.remove('animate-bounce-wiggle');
                    }, 300); // Animation duration
                }
                lastPercentage = newPercentage; // Update last percentage

                // Update ARIA attributes for accessibility
                kcalProgressBarContainer.setAttribute('aria-valuenow', currentKcalSum);
                kcalProgressBarContainer.setAttribute('aria-valuetext', `${currentKcalSum} out of ${KCAL_CAP} Kcal consumed today.`);
            }


            // --- Function to load data from Notion via backend (GET request) ---
            async function loadNotionItems() {
                // Display skeleton loader effect
                notionItemsDisplay.innerHTML = getSkeletonLoaderHtml(4); // Show 4 loading lines
                notionItemsDisplay.classList.add('bg-gray-100'); // Add a base background for the loader container

                let sumTotalKcal = 0; // Initialize sum for the progress bar

                try {
                    const response = await fetch(NOTION_BACKEND_URL, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        console.error('Backend (GET) error:', errorData);
                        throw new Error(`Error: ${errorData.message || errorData.error || 'Unknown backend error'}`);
                    }

                    const data = await response.json();
                    const items = data.items;

                    // Clear skeleton loader
                    notionItemsDisplay.innerHTML = ''; 
                    notionItemsDisplay.classList.remove('bg-gray-100'); // Remove base loading background

                    if (items.length === 0) {
                        // Empty state with a more engaging message and icon
                        notionItemsDisplay.innerHTML = `
                            <div class="text-center py-8">
                                <img src="https://cdn-icons-png.flaticon.com/512/7465/7465225.png" alt="Empty state icon" class="w-24 h-24 mx-auto mb-4 opacity-70">
                                <p class="text-gray-500 font-semibold text-lg">Nothing logged for today yet!</p>
                                <p class="text-gray-400 text-sm mt-1">Start by adding your first meal on the 'Add' tab.</p>
                            </div>
                        `;
                    } else {
                        // **REVERTED: Removed grouping and sorting by category**
                        items.forEach(item => {
                            sumTotalKcal += item.total; // Summing up Kcal for the progress bar
                            // Exclude "Untitled Page" and "Untitled" from description
                            const descriptionPart = (item.name && item.name !== 'Untitled' && item.name !== 'Untitled Page' && item.name.trim() !== '') ? ` - ${item.name}` : '';

                            // **REVERTED: Removed timestamp display**
                            // const timeString = ''; // No timestamp

                            const itemDiv = document.createElement('div');
                            // Increased text size for better readability and space filling
                            itemDiv.className = 'py-2 flex justify-between items-center border-b border-gray-100 last:border-b-0 last:pb-0 text-base md:text-lg'; // Added text-base md:text-lg
                            itemDiv.innerHTML = `
                                <div class="flex-1 overflow-hidden text-ellipsis pr-2 font-semibold">
                                    ${item.Type}${descriptionPart}
                                </div>
                                <div class="font-bold ${item.total < 0 ? 'text-red-500' : 'text-green-600'}"> 
                                    ${item.total} Kcal
                                </div>
                            `;
                            notionItemsDisplay.appendChild(itemDiv);
                        });
                    }
                } catch (error) {
                    console.error('Failed to load items from Notion:', error);
                    notionItemsDisplay.innerHTML = `<p class="text-center text-red-500">Failed to load items: ${error.message}</p>`;
                } finally {
                    updateKcalProgressBar(sumTotalKcal); // Update progress bar after loading items
                }
            }

            // --- Event Listeners ---
            sendBtn.addEventListener('click', function() {
                const category = hiddenCategoryInput.value;
                const description = descriptionInput.value;
                let kcal = kcalInput.value; // Get Kcal value as is

                // Validate inputs
                if (!category) {
                    messageArea.textContent = 'Please select a category.';
                    messageArea.style.color = '#dc2626';
                    return;
                }
                if (!kcal || isNaN(parseFloat(kcal))) { // Use parseFloat for potential negative values
                    messageArea.textContent = 'Please enter a valid Kcal value.';
                    messageArea.style.color = '#dc2626';
                    return;
                }

                // Ensure Kcal is an integer for Notion
                kcal = parseInt(kcal, 10);

                sendToNotion({ category, description, kcal });
            });

            tabCategoryBtn.addEventListener('click', () => showTab('category'));
            tabTodayBtn.addEventListener('click', () => showTab('today'));

            // Initial load
            // Call loadNotionItems immediately on page load to set initial Kcal sum
            loadNotionItems();
            showTab('category'); // Start on the "Add" tab
        });
    </script>
</body>
</html>